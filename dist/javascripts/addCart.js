"use strict";!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(l){function a(){}l.fn.addCart=function(t){(new a).init(this,t)},l.extend(a.prototype,{init:function(t,a){this.that=t,(this.options=a).num&&(this.num=a.num),a.btn&&(this.btn=a.btn),a.add&&(this.add=a.add),a.addcont&&(this.addcont=a.addcont),a.addcont||(this.cont=parseInt(l(this.num).val())),this.bindEvent(),this.start()},bindEvent:function(){var t=this;this.btn&&l(this.btn).on("click",function(){t.changeNums.bind(this)(t)}),this.add&&l(this.add).on("click",function(){t.addCart.bind(this)(t)}),this.addcont&&l(this.addcont).on("click",function(){t.addCont.bind(this)(t)}),this.choose(),this.removeCommodity(),this.removeSelected()},changeNums:function(t){console.log(1),t.parent=t.addcont?l(this).parentsUntil(".table_wrap",".table_item"):"body",t.cont=parseInt(l(t.num,t.parent).val());var a=l(this).text();switch(t.tname=l(".title_name",t.parent).text(),a){case"+":t.cont+=1;break;case"-":if(1==t.cont)break;t.cont-=1}l(t.num,t.parent).val(t.cont)},changeNum:function(){var t=0,a=localStorage.getItem("cartItem")?JSON.parse(localStorage.getItem("cartItem")):{data:[],cont:0};for(var e in a.data)t+=a.data[e].cont;a.cont=t,localStorage.setItem("cartItem",JSON.stringify(a)),l("body").shoppingCart({cartNum:".cartNum"})},addCart:function(t){var a=window.location.search,e=a.split("=")[1],o=null;"id"==a.split("=")[0].split("?")[1]&&(o=localStorage.getItem("details"+e)),(o=JSON.parse(o)).cont=t.cont;var n=!0,i=localStorage.getItem("cartItem")?JSON.parse(localStorage.getItem("cartItem")):{data:[],cont:0};for(var l in i.data)o.name==i.data[l].name&&(i.data[l].cont=parseInt(i.data[l].cont)+o.cont,n=!1);n&&i.data.push(o),localStorage.setItem("cartItem",JSON.stringify(i)),t.changeNum()},addCont:function(t){var a=localStorage.getItem("cartItem")?JSON.parse(localStorage.getItem("cartItem")):{data:[]};for(var e in a.data)t.tname==a.data[e].name&&(a.data[e].cont=t.cont,l(".table_sum",t.parent).text(t.cont*a.data[e].price));var o=l(this).parentsUntil(".table_cont",".table_items");localStorage.setItem("cartItem",JSON.stringify(a)),t.smallAdd.bind(this)(o),t.bigAdd()},smallAdd:function(t){for(var a=l(".table_item",t),e=0,o=0,n=0,i=this.smallNum=0;i<a.length;i++)"true"==l(".ifChoose",a[i]).attr("ifChoose")&&(e+=parseFloat(l(".table_sum",a[i]).text()),n+=parseInt(l(".num_num",a[i]).val()),parseFloat(l(".table_sum",a[i]).text())<68&&(o+=10),this.smallNum++);l(t).attr("cont",n),0==o&&(o="本次包邮"),0==e?(l(".allbtn_cont i",t).attr("ifChoose","false"),l(".allbtn_cont i",t).removeClass("on")):a.length==this.smallNum?(l(".table_type .allbtn_cont i",t).attr("ifChoose","true"),l(".table_type .allbtn_cont i",t).addClass("on")):(l(".table_type .allbtn_cont i",t).attr("ifChoose","false"),l(".table_type .allbtn_cont i",t).removeClass("on")),l(".price",t).text(e),l(".freight",t).text(o)},addColor:function(t,a,e){"true"==l(a=a||this).attr("ifChoose")?(l(a).attr("ifChoose","false"),l(a).removeClass("on")):(l(a).attr("ifChoose","true"),l(a).addClass("on"))},choose:function(){var a=this;l(".choose").on("click",function(){var t=l(this).parentsUntil(".table_cont",".table_items");a.addColor(a,this),a.smallAdd.bind(this)(t),a.bigAdd()}),l(".allChoose").on("click",function(){a.addColor(a,l(".allbtn_cont i","body")),a.smallAdd.bind(this)(),a.bigAdd()}),l(".allchoose").on("click",function(){var t=l(this).parentsUntil(".table_cont",".table_items");a.addColor(a,l(".allbtn_cont i",t)),a.smallAdd.bind(this)(t),a.bigAdd()})},bigAdd:function(){for(var t=l(".table_items","body"),a=0,e=0,o=0,n=this.bigNum=0;n<t.length;n++)"true"==l(".allbtn_cont i",t[n]).attr("ifChoose")&&this.bigNum++,"0"!=l(".table_type_right .price",t[n]).text()&&(a+=parseFloat(l(".price",t[n]).text()),"本次包邮"!=l(".table_type_right .freight",t[n]).text()&&(e+=parseFloat(l(".freight",t[n]).text())),o+=parseInt(l(t[n]).attr("cont")));l(".commodity_price").text(a+e),0==a?(l(".allbtn_cont i","body").attr("ifChoose","false"),l(".allbtn_cont i","body").removeClass("on"),console.log(l("#buy")),l("#goBuy").addClass("invalid")):t.length==this.bigNum?(l(".allChoose").attr("ifChoose","true"),l(".allChoose").addClass("on"),l("#goBuy").removeClass("invalid")):(l("#goBuy").removeClass("invalid"),l(".allChoose").attr("ifChoose","false"),l(".allChoose").removeClass("on")),l("#commodity_cont").text(o);var i=localStorage.getItem("cartItem")?JSON.parse(localStorage.getItem("cartItem")):{data:[],cont:0};i.cont=o,localStorage.setItem("cartItem",JSON.stringify(i))},start:function(){for(var t=l(".table_items"),a=0;a<t.length;a++)this.smallAdd(t[a]);this.bigAdd(),this.changeNum()},removeCommodity:function(){var n=this;l(".table_del").on("click",function(){var t=l(this).parentsUntil(".table_items",".table_item"),a=localStorage.getItem("cartItem")?JSON.parse(localStorage.getItem("cartItem")):{data:[]},e=l(".title_name",t).text();for(var o in a.data)e==a.data[o].name&&a.data.splice(o,1);l(this).parentsUntil(".table_cont",".table_items");localStorage.setItem("cartItem",JSON.stringify(a)),t.remove(),n.start(),location.reload()})},removeSelected:function(){l(".removeSelected").on("click",function(){for(var t=l(".table_item"),a=0;a<t.length;a++)"true"==l(".ifChoose",t[a]).attr("ifChoose")&&l(".table_del",t[a]).trigger("click")})}})});
//# sourceMappingURL=addCart.js.map
